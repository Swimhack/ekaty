var K=Object.defineProperty;var V=(r,s,a)=>s in r?K(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var L=(r,s,a)=>V(r,typeof s!="symbol"?s+"":s,a);import{h as E,s as Z,r as i,j as e,X as H,i as W,k as G,H as X,A as Y,R as Q,U as ee}from"./index-VFvYmn6b.js";import{U as se,L as te}from"./user-jqpcped0.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=E("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=E("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=E("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=E("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=E("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=E("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=E("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=E("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);class de{constructor(){L(this,"currentUserId",null);L(this,"currentUsername",null);L(this,"currentAvatarUrl",null)}async initialize(s,a,n){this.currentUserId=s,this.currentUsername=a,this.currentAvatarUrl=n}async testConnection(){try{const{data:s,error:a}=await Z.from("user_profiles").select("count").limit(1);return!a}catch(s){return console.error("Connection test failed:",s),!1}}async getMessages(s,a=50,n=0){try{return[{id:"1",user_id:"1",username:"Sarah M.",avatar_url:"/images/avatar1.jpg",message:"Just tried the new Italian place on Mason Road - absolutely amazing! The pasta was perfectly cooked and the service was outstanding. Highly recommend! 🍝",timestamp:new Date(Date.now()-9e5).toISOString(),likes:8,is_edited:!1,is_deleted:!1,replies:[{id:"1a",user_id:"2",username:"Mike K.",avatar_url:"/images/avatar2.jpg",message:"Which dish did you try? I've been wanting to check it out!",timestamp:new Date(Date.now()-6e5).toISOString(),likes:2,is_edited:!1,is_deleted:!1}]},{id:"2",user_id:"3",username:"James R.",avatar_url:"/images/avatar3.jpg",message:"Anyone know if Local Foods is still doing their happy hour specials? Planning to meet friends there later!",timestamp:new Date(Date.now()-18e5).toISOString(),likes:3,is_edited:!1,is_deleted:!1},{id:"3",user_id:"4",username:"Emma L.",avatar_url:"/images/avatar4.jpg",message:"The farmers market this weekend was incredible! Picked up some fresh ingredients and tried the new food truck. Katy's food scene just keeps getting better! 🌟",timestamp:new Date(Date.now()-27e5).toISOString(),likes:15,is_edited:!1,is_deleted:!1}]}catch(o){return console.error("Failed to fetch messages:",o),[]}}async sendMessage(s,a){if(!this.currentUserId||!this.currentUsername)throw new Error("User not initialized");try{return{id:Date.now().toString(),user_id:this.currentUserId,username:this.currentUsername,avatar_url:this.currentAvatarUrl||"/images/default-avatar.jpg",message:s.trim(),timestamp:new Date().toISOString(),likes:0,parent_id:a,is_edited:!1,is_deleted:!1}}catch(n){return console.error("Failed to send message:",n),null}}async updateMessage(s,a){if(!this.currentUserId)throw new Error("User not initialized");try{return{id:s,user_id:this.currentUserId,username:this.currentUsername||"User",avatar_url:this.currentAvatarUrl||"/images/default-avatar.jpg",message:a.trim(),timestamp:new Date().toISOString(),likes:0,is_edited:!0,is_deleted:!1}}catch(n){return console.error("Failed to update message:",n),null}}async deleteMessage(s){if(!this.currentUserId)throw new Error("User not initialized");try{return!0}catch(a){return console.error("Failed to delete message:",a),!1}}async toggleLike(s){if(!this.currentUserId)throw new Error("User not initialized");try{return Math.random()>.5}catch(a){return console.error("Failed to toggle like:",a),null}}async getOnlineUsers(){try{return[{user_id:"1",username:"Sarah M.",avatar_url:"/images/avatar1.jpg",is_online:!0,last_seen:new Date().toISOString()},{user_id:"2",username:"Mike K.",avatar_url:"/images/avatar2.jpg",is_online:!0,last_seen:new Date().toISOString()},{user_id:"3",username:"James R.",avatar_url:"/images/avatar3.jpg",is_online:!0,last_seen:new Date().toISOString()}]}catch(s){return console.error("Failed to fetch online users:",s),[]}}cleanup(){}}const v=new de;class ue{constructor(){L(this,"currentUser",null);L(this,"authListeners",[])}async initialize(){try{const s=localStorage.getItem("community_user");return s?(this.currentUser=JSON.parse(s),this.currentUser):null}catch(s){return console.error("Error initializing user service:",s),null}}async signUp(s,a,n){try{await new Promise(d=>setTimeout(d,1e3));const o=JSON.parse(localStorage.getItem("community_users")||"[]");if(o.find(d=>d.username===n))return{success:!1,error:"Username already taken"};const h={id:Date.now().toString(),username:n,email:s,avatar_url:"/images/default-avatar.jpg",created_at:new Date().toISOString(),last_seen:new Date().toISOString(),is_online:!0};return o.push(h),localStorage.setItem("community_users",JSON.stringify(o)),localStorage.setItem("community_user",JSON.stringify(h)),this.currentUser=h,this.notifyAuthListeners(h),{success:!0}}catch(o){return console.error("Error signing up:",o),{success:!1,error:"An unexpected error occurred"}}}async signIn(s,a){try{await new Promise(d=>setTimeout(d,1e3));const n=JSON.parse(localStorage.getItem("community_users")||"[]"),o=n.find(d=>d.email===s);if(!o)return{success:!1,error:"User not found"};o.last_seen=new Date().toISOString(),o.is_online=!0,localStorage.setItem("community_user",JSON.stringify(o));const h=n.map(d=>d.id===o.id?o:d);return localStorage.setItem("community_users",JSON.stringify(h)),this.currentUser=o,this.notifyAuthListeners(o),{success:!0,user:o}}catch(n){return console.error("Error signing in:",n),{success:!1,error:"An unexpected error occurred"}}}async signOut(){try{if(this.currentUser){this.currentUser.is_online=!1,this.currentUser.last_seen=new Date().toISOString();const a=JSON.parse(localStorage.getItem("community_users")||"[]").map(n=>n.id===this.currentUser.id?this.currentUser:n);localStorage.setItem("community_users",JSON.stringify(a))}localStorage.removeItem("community_user"),this.currentUser=null,this.notifyAuthListeners(null)}catch(s){console.error("Error signing out:",s)}}getCurrentUser(){return this.currentUser}isAuthenticated(){return this.currentUser!==null}onAuthStateChange(s){return this.authListeners.push(s),()=>{this.authListeners=this.authListeners.filter(a=>a!==s)}}notifyAuthListeners(s){this.authListeners.forEach(a=>a(s))}cleanup(){this.authListeners=[]}}const D=new ue;function me({isOpen:r,onClose:s,onSuccess:a}){const[n,o]=i.useState(!1),[h,d]=i.useState(""),[b,j]=i.useState(""),[u,U]=i.useState(""),[k,g]=i.useState(!1),[N,C]=i.useState(!1),[S,f]=i.useState("");if(!r)return null;const y=async p=>{p.preventDefault(),f(""),C(!0);try{if(n){const w=await D.signUp(h,b,u);w.success?(a(),s()):f(w.error||"Sign up failed")}else{const w=await D.signIn(h,b);w.success?(a(),s()):f(w.error||"Sign in failed")}}catch{f("An unexpected error occurred")}finally{C(!1)}},_=()=>{d(""),j(""),U(""),f(""),C(!1)},M=()=>{_(),s()},A=()=>{o(!n),_()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n?"Join the Community":"Welcome Back"}),e.jsx("button",{onClick:M,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(H,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-4",children:[S&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:S})}),n&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{id:"username",type:"text",value:u,onChange:p=>U(p.target.value),required:n,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Choose a username"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{id:"email",type:"email",value:h,onChange:p=>d(p.target.value),required:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Enter your email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{id:"password",type:k?"text":"password",value:b,onChange:p=>j(p.target.value),required:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Enter your password"}),e.jsx("button",{type:"button",onClick:()=>g(!k),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:k?e.jsx(re,{className:"h-5 w-5"}):e.jsx(ae,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:N,className:"w-full bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:N?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),n?"Creating Account...":"Signing In..."]}):n?"Create Account":"Sign In"})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[n?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{onClick:A,className:"text-orange-500 hover:text-orange-600 font-medium",children:n?"Sign In":"Sign Up"})]})}),n&&e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["By creating an account, you agree to our"," ",e.jsx("a",{href:"/terms",className:"text-orange-500 hover:text-orange-600",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/privacy",className:"text-orange-500 hover:text-orange-600",children:"Privacy Policy"})]})})]})})}function he({message:r,onLike:s,onReply:a,onUpdate:n,onDelete:o,isLiked:h=!1,showReplies:d=!1}){const[b,j]=i.useState(!1),[u,U]=i.useState(r.message),[k,g]=i.useState(!1),[N,C]=i.useState(!1),[S,f]=i.useState(!1),y=D.getCurrentUser(),_=(y==null?void 0:y.id)===r.user_id,M=(y==null?void 0:y.id)===r.user_id,A=x=>{const I=new Date(x),B=new Date().getTime()-I.getTime(),O=Math.floor(B/6e4);if(O<1)return"just now";if(O<60)return`${O}m ago`;const R=Math.floor(O/60);return R<24?`${R}h ago`:I.toLocaleDateString()},p=()=>{s(r.id)},w=()=>{a(r.id)},J=()=>{j(!0),U(r.message),g(!1)},z=async()=>{if(confirm("Are you sure you want to delete this message?")){f(!0);try{await o(r.id)}finally{f(!1)}g(!1)}},P=async()=>{if(u.trim()===r.message){j(!1);return}C(!0);try{await n(r.id,u.trim()),j(!1)}finally{C(!1)}},T=()=>{j(!1),U(r.message)};return r.is_deleted?e.jsx("div",{className:"p-4 text-center text-gray-500 italic",children:e.jsx("p",{children:"This message has been deleted"})}):e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("img",{src:r.avatar_url||"/images/default-avatar.jpg",alt:`${r.username} avatar`,className:"h-10 w-10 rounded-full bg-gray-200 flex-shrink-0",onError:x=>{const I=x.target;I.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><rect width="40" height="40" fill="%23e5e7eb"/><text x="20" y="25" font-family="Arial" font-size="16" fill="%236b7280" text-anchor="middle">👤</text></svg>'}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:r.username}),e.jsx("span",{className:"text-sm text-gray-500",children:A(r.timestamp)}),r.is_edited&&e.jsx("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),(_||M)&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>g(!k),className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100",children:e.jsx(ne,{className:"h-4 w-4"})}),k&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-32 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10",children:[_&&e.jsxs("button",{onClick:J,className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]}),M&&e.jsxs("button",{onClick:z,disabled:S,className:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2 disabled:opacity-50",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:S?"Deleting...":"Delete"})]})]})]})]}),b?e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("textarea",{value:u,onChange:x=>U(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none",rows:3,disabled:N}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:P,disabled:N||!u.trim(),className:"inline-flex items-center space-x-2 px-3 py-1 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:N?"Saving...":"Save"})]}),e.jsxs("button",{onClick:T,disabled:N,className:"inline-flex items-center space-x-2 px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:"Cancel"})]})]})]}):e.jsx("p",{className:"mt-1 text-gray-700 whitespace-pre-wrap break-words",children:r.message}),e.jsxs("div",{className:"flex items-center space-x-4 mt-3",children:[e.jsxs("button",{onClick:p,className:`flex items-center space-x-1 text-sm transition-colors ${h?"text-orange-500":"text-gray-500 hover:text-orange-500"}`,children:[e.jsx(X,{className:`h-4 w-4 ${h?"fill-current":""}`}),e.jsx("span",{children:r.likes})]}),e.jsxs("button",{onClick:w,className:"flex items-center space-x-1 text-sm text-gray-500 hover:text-orange-500 transition-colors",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"Reply"})]})]}),r.replies&&r.replies.length>0&&d&&e.jsx("div",{className:"mt-3 ml-4 space-y-2",children:r.replies.map(x=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("img",{src:x.avatar_url||"/images/default-avatar.jpg",alt:`${x.username} avatar`,className:"h-8 w-8 rounded-full bg-gray-200 flex-shrink-0",onError:I=>{const F=I.target;F.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect width="32" height="32" fill="%23e5e7eb"/><text x="16" y="20" font-family="Arial" font-size="12" fill="%236b7280" text-anchor="middle">👤</text></svg>'}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:x.username}),e.jsx("span",{className:"text-xs text-gray-500",children:A(x.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-700",children:x.message})]})]},x.id))})]})]})})}function ye(){const[r,s]=i.useState([]),[a,n]=i.useState(""),[o,h]=i.useState(!1),[d,b]=i.useState(!0),[j,u]=i.useState(null),[U,k]=i.useState([]),[g,N]=i.useState(null),[C,S]=i.useState(!1),[f,y]=i.useState(!1),[_,M]=i.useState(null),[A,p]=i.useState(new Set),w=i.useRef(null),J=i.useRef(null);i.useEffect(()=>{(async()=>{try{b(!0),u(null);const l=await D.initialize();N(l),l&&await v.initialize(l.id,l.username,l.avatar_url);const m=await v.testConnection();h(m),m?(await z(),await P()):u("Could not connect to the discussion service. Please try again later.")}catch(l){console.error("Error initializing services:",l),u("Failed to initialize services. Please refresh the page.")}finally{b(!1)}})();const c=D.onAuthStateChange(async l=>{N(l),l?(await v.initialize(l.id,l.username,l.avatar_url),await z(),await P()):(s([]),k([]))});return()=>{c(),v.cleanup(),D.cleanup()}},[]);const z=async()=>{try{const t=await v.getMessages();s(t)}catch(t){console.error("Error loading messages:",t),u("Failed to load messages. Please try again.")}},P=async()=>{try{const t=await v.getOnlineUsers();k(t)}catch(t){console.error("Error loading online users:",t)}},T=async()=>{b(!0),u(null);try{const t=await v.testConnection();h(t),t?(await z(),await P()):u("Still unable to connect. Please check your internet connection.")}catch{u("Connection retry failed. Please refresh the page.")}finally{b(!1)}},x=async t=>{if(t.preventDefault(),!(!a.trim()||!o||!g)){y(!0);try{const c=await v.sendMessage(a.trim(),_||void 0);c&&(s(l=>[c,...l]),n(""),M(null),R())}catch(c){console.error("Error sending message:",c),u("Failed to send message. Please try again.")}finally{y(!1)}}},I=async t=>{if(g)try{const c=await v.toggleLike(t);c!==null&&(p(l=>{const m=new Set(l);return c?m.add(t):m.delete(t),m}),s(l=>l.map(m=>m.id===t?{...m,likes:c?m.likes+1:Math.max(0,m.likes-1)}:m)))}catch(c){console.error("Error toggling like:",c)}},F=t=>{M(t);const c=document.querySelector('textarea[placeholder*="Share your thoughts"]');c&&c.focus()},B=async(t,c)=>{try{const l=await v.updateMessage(t,c);l&&s(m=>m.map($=>$.id===t?l:$))}catch(l){console.error("Error updating message:",l),u("Failed to update message. Please try again.")}},O=async t=>{try{await v.deleteMessage(t)&&s(l=>l.map(m=>m.id===t?{...m,is_deleted:!0}:m))}catch(c){console.error("Error deleting message:",c),u("Failed to delete message. Please try again.")}},R=()=>{var t;(t=w.current)==null||t.scrollIntoView({behavior:"smooth"})};return i.useEffect(()=>{R()},[r]),d?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Connecting to Community Chat..."}),e.jsx("p",{className:"text-gray-500",children:"Please wait while we establish connection"})]})}):!o&&j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center max-w-md mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-red-200",children:[e.jsx(Y,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Connection Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:j}),e.jsxs("button",{onClick:T,disabled:d,className:"inline-flex items-center space-x-2 px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Q,{className:`h-5 w-5 ${d?"animate-spin":""}`}),e.jsx("span",{children:d?"Retrying...":"Retry Connection"})]})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Community Chat"}),e.jsx("p",{className:"text-gray-600",children:"Connect with fellow food lovers in Katy"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[U.length," online"]})]}),g?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:g.avatar_url||"/images/default-avatar.jpg",alt:g.username,className:"h-8 w-8 rounded-full bg-gray-200",onError:t=>{const c=t.target;c.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect width="32" height="32" fill="%23e5e7eb"/><text x="16" y="20" font-family="Arial" font-size="12" fill="%236b7280" text-anchor="middle">👤</text></svg>'}}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:g.username}),e.jsx("button",{onClick:()=>D.signOut(),className:"text-sm text-gray-500 hover:text-gray-700",children:"Sign Out"})]}):e.jsx("button",{onClick:()=>S(!0),className:"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors",children:"Sign In"})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[g?e.jsxs("div",{className:"border-b border-gray-200 p-4",children:[_&&e.jsx("div",{className:"mb-3 p-2 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-orange-700",children:"Replying to a message..."}),e.jsx("button",{onClick:()=>M(null),className:"text-orange-500 hover:text-orange-600 text-sm",children:"Cancel"})]})}),e.jsxs("form",{onSubmit:x,className:"flex space-x-3",children:[e.jsx("img",{src:g.avatar_url||"/images/default-avatar.jpg",alt:"Your avatar",className:"h-10 w-10 rounded-full bg-gray-200",onError:t=>{const c=t.target;c.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><rect width="40" height="40" fill="%23e5e7eb"/><text x="20" y="25" font-family="Arial" font-size="16" fill="%236b7280" text-anchor="middle">👤</text></svg>'}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:a,onChange:t=>n(t.target.value),placeholder:"Share your thoughts about Katy restaurants...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none",rows:3,disabled:f}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Be respectful and share your honest dining experiences"}),e.jsxs("button",{type:"submit",disabled:!a.trim()||f,className:"inline-flex items-center space-x-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:f?"Sending...":"Send"})]})]})]})]})]}):e.jsxs("div",{className:"border-b border-gray-200 p-8 text-center",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Join the Conversation"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Sign in to start chatting with the community"}),e.jsx("button",{onClick:()=>S(!0),className:"bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors",children:"Sign In to Chat"})]}),e.jsxs("div",{ref:J,className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:[r.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No messages yet. Start the conversation!"})]}):r.map(t=>e.jsx(he,{message:t,onLike:I,onReply:F,onUpdate:B,onDelete:O,isLiked:A.has(t.id),showReplies:!0},t.id)),e.jsx("div",{ref:w})]})]}),e.jsxs("div",{className:"mt-6 bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-orange-800 mb-2",children:"Community Guidelines"}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Share honest reviews and dining experiences"}),e.jsx("li",{children:"• Be respectful to restaurant owners and fellow diners"}),e.jsx("li",{children:"• No spam, self-promotion, or inappropriate content"}),e.jsx("li",{children:"• Help build a supportive local food community"})]})]})]}),e.jsx(me,{isOpen:C,onClose:()=>S(!1),onSuccess:()=>{S(!1)}})]})}export{ye as default};
//# sourceMappingURL=Community-etok5ydB.js.map
