import{u as D,r as l,a as q,j as e,N as E,P as H,E as Q,S as B,b as U,c as W,d as O,C as V,M as k,e as G,L as I,f as _,g as v}from"./index-VgQ7sLoW.js";function X(){const[n,h]=D(),[u,P]=l.useState([]),[N,F]=l.useState([]),[i,w]=l.useState(!0),[g,K]=l.useState(!0),{errorState:m,setError:L,clearError:S}=q(3),[o,p]=l.useState(n.get("q")||""),[t,x]=l.useState(n.get("cuisine")||""),[c,f]=l.useState(n.get("area")||""),[y,z]=l.useState("name");l.useEffect(()=>{const s=n.get("q")||"",a=n.get("cuisine")||"",r=n.get("area")||"";console.log("ðŸ” URL params changed:",{q:s,cuisine:a,area:r}),p(s),x(a),f(r)},[n]);const C=async()=>{try{S(),w(!0),console.log("ðŸ” Restaurants page filters:",{searchQuery:o||void 0,selectedCuisine:t||void 0,selectedArea:c||void 0});const[s,a]=await Promise.all([_.getRestaurants({search:o||void 0,cuisine:t||void 0,area:c||void 0,limit:50,offset:0}),g?_.getCuisines():Promise.resolve(N)]);console.log("ðŸ” Restaurant response:",s),console.log("ðŸ” Available cuisines:",a),P(s.restaurants),g&&(F(a),K(!1))}catch(s){console.error("Error fetching data:",s);const a=s instanceof Error?s.message.toLowerCase():"";let r="generic";if(s instanceof Error&&s.name)switch(s.name){case"NetworkError":r="network";break;case"TimeoutError":r=a.includes("cloudflare")||a.includes("cf-ray")||a.includes("connection timed out")?"cloudflare":"timeout";break;default:r="api"}else(a.includes("cloudflare")||a.includes("timeout"))&&(r="cloudflare");L(s,r)}finally{w(!1)}},M=async()=>{try{S(),await C()}catch(s){console.error("Retry failed:",s)}};l.useEffect(()=>{C()},[o,t,c]),l.useEffect(()=>{const s=new URLSearchParams;o&&s.set("q",o),t&&s.set("cuisine",t),c&&s.set("area",c),h(s)},[o,t,c,h]);const R=l.useMemo(()=>{const s=[...u];switch(y){case"rating":return s.sort((a,r)=>r.average_rating-a.average_rating);case"reviews":return s.sort((a,r)=>r.total_reviews-a.total_reviews);case"name":default:return s.sort((a,r)=>a.name.localeCompare(r.name))}},[u,y]),$=s=>{s.preventDefault()},A=s=>{const a=[],r=Math.floor(s),b=s%1>=.5;for(let d=0;d<r;d++)a.push(e.jsx(v,{size:14,className:"fill-yellow-400 text-yellow-400"},d));b&&a.push(e.jsx(v,{size:14,className:"fill-yellow-400 text-yellow-400 opacity-50"},"half"));const j=5-Math.ceil(s);for(let d=0;d<j;d++)a.push(e.jsx(v,{size:14,className:"text-gray-300"},`empty-${d}`));return a},T=s=>"$".repeat(s)+"$".repeat(Math.max(0,4-s));return i&&u.length===0?e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx(H,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx(Q,{children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gray-900 mb-2",children:t?`${t} Restaurants in Katy`:"Restaurants in Katy, Texas"}),e.jsx("p",{className:"text-xl text-gray-600",children:i?"Loading amazing dining options...":t?`Found ${u.length} ${t.toLowerCase()} restaurants in the Katy area`:`Discover ${u.length} amazing dining options in the Katy area`}),t&&e.jsx("div",{className:"mt-4",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:[e.jsx("span",{className:"mr-2",children:"ðŸ½ï¸"}),"Filtering by: ",t,e.jsx("button",{onClick:()=>{x("");const s=new URLSearchParams(n);s.delete("cuisine"),h(s)},className:"ml-2 text-orange-600 hover:text-orange-800",title:"Clear filter",children:"Ã—"})]})})]}),g?e.jsx(B,{}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:o,onChange:s=>p(s.target.value),placeholder:"Search restaurants, cuisines, or dishes...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:i,"aria-label":"Search restaurants"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("select",{value:t,onChange:s=>x(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,"aria-label":"Filter by cuisine",children:[e.jsx("option",{value:"",children:"All Cuisines"}),N.map(s=>e.jsxs("option",{value:s.name,children:[s.name," (",s.restaurant_count,")"]},s.id))]}),e.jsxs("select",{value:c,onChange:s=>f(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,"aria-label":"Filter by area",children:[e.jsx("option",{value:"",children:"All Areas"}),e.jsx("option",{value:"Katy",children:"Katy"}),e.jsx("option",{value:"Cinco Ranch",children:"Cinco Ranch"}),e.jsx("option",{value:"Mason Creek",children:"Mason Creek"}),e.jsx("option",{value:"Cross Creek Ranch",children:"Cross Creek Ranch"}),e.jsx("option",{value:"Old Katy",children:"Old Katy"}),e.jsx("option",{value:"West Katy",children:"West Katy"})]}),e.jsxs("select",{value:y,onChange:s=>z(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,"aria-label":"Sort restaurants",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"rating",children:"Sort by Rating"}),e.jsx("option",{value:"reviews",children:"Sort by Reviews"})]})]}),e.jsx("button",{type:"submit",className:"w-full md:w-auto bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",disabled:i,children:i?"Searching...":"Search Restaurants"})]})}),m.hasError&&e.jsx("div",{className:"mb-8",children:e.jsx(W,{error:m.error,errorType:m.errorType,onRetry:M,size:"medium"})}),i?e.jsx(O,{}):R.length===0&&!m.hasError?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No restaurants found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search criteria or filters."}),e.jsx("button",{onClick:()=>{p(""),x(""),f("")},className:"btn-secondary",children:"Clear Filters"})]}):m.hasError?null:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:R.map(s=>{var a,r;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200",children:[e.jsx("img",{src:s.image||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=250&fit=crop&crop=center",alt:s.name,className:"w-full h-full object-cover",onError:b=>{const j=b.target;j.src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=250&fit=crop&crop=center"}}),e.jsx("div",{className:"absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-full text-sm font-medium",children:T(s.price_range)})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsx("h3",{className:"text-lg font-bold text-gray-900 line-clamp-1",children:s.name})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:A(s.average_rating||0)}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:(s.average_rating||0).toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.total_reviews||0," reviews)"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsx("span",{className:"font-medium text-blue-600",children:((a=s.primary_cuisine)==null?void 0:a.name)||"Restaurant"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{size:14}),e.jsx("span",{children:((r=s.area)==null?void 0:r.name)||"Katy"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.delivery_available&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Delivery"}),s.takeout_available&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Takeout"}),s.kid_friendly&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Kid Friendly"}),s.wifi_available&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:"WiFi"})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:14}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{size:14}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-blue-600",children:s.phone})]})]}),e.jsx(I,{to:`/restaurant/${s.slug||s.id}`,className:"block w-full text-center bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 transition-colors font-medium",children:"View Full Profile"})]})]},s.id)})})]})})]})}export{X as default};
//# sourceMappingURL=Restaurants-C8EjvRtZ.js.map
